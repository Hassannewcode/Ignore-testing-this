
<!DOCTYPE html>
<html>
  <head>
    <title>Monospace Preview Server</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Google+Sans+Mono:wght@400;500;700&amp;family=JetBrains+Mono:wght@400;500;700&amp;family=Google+Sans+Code:ital,wght@0,300..800;1,300..800"
    />
    <link rel="stylesheet" href="codicons/codicon.css" />
    <link rel="stylesheet" href="bundle.css" />
    <script>
      const isLocal = false;

      window['CONTEXT'] = {
        currentAppVersion: 1,
        initialAppState: "RUNNING",
        target: "android",
        daemonHost: absolutePath("/r/9001"),
        previewHost: generatePreviewHost(),
      };

      function getReplacedPort(host, previewPort) {
        const matched = host.match(/^[0-9]+-/);
        if(! matched) {
          return `https://${previewPort}-${host}`;
        }
        const matchedPort = host.match(/^[0-9]+-/) [0];
        return `https://${host.replace(matchedPort, previewPort + "-")}`;
      }

      function generatePreviewHost() {
        // We can assume this is local dev so we always serve 9002
        if (isLocal) {
          return "https://" + window.location.host.replace("9001", "9002");
        }
        //current url is already in preview port, do nothing
        else if(window.location.host.startsWith('8686-')) {
          return "https://" + window.location.host;
        }
        // This is how we can open previewPort on GCW
        return getReplacedPort(window.location.host, '8686');
      }

      function absolutePath(href) {
        const removeTrailingSlash = (str) => str.replace(/\/+$/, "");
        const link = document.createElement("a");
        link.href = href;
        return removeTrailingSlash(
          link.protocol + "//" + link.host + link.pathname + link.search + link.hash
        );
      }
    </script>
  </head>
  <body>
    <div id="app-root"></div>
    <script src="bundle.js" type="text/javascript"></script>
  </body>
</html>
